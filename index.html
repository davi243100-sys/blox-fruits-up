<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Blox Fruits UP ‚Äî Loja Oficial</title>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <style>
    body{margin:0;font-family:Arial;background:#0b1020;color:#e6e8ff}
    .hidden{display:none}
    header{display:flex;justify-content:space-between;align-items:center;padding:14px 18px;background:#0f1433}
    .container{padding:18px}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:14px}
    .card{background:#121735;border-radius:14px;padding:16px}
    input,button,textarea{width:100%;padding:10px;border-radius:10px;border:none;margin-top:8px}
    input,textarea{background:#1b2150;color:#fff}
    button{background:#6c7cff;color:#0b1020;font-weight:700;cursor:pointer}
    .secondary{background:#232a6b;color:#fff}
    .toast{position:fixed;right:18px;bottom:18px;background:#121735;padding:14px;border-radius:12px}
    .notif{position:fixed;right:18px;top:70px;background:#121735;padding:14px;border-radius:12px;width:340px;max-height:65vh;overflow:auto}
    .badge{background:#ff4d4f;color:#fff;border-radius:999px;padding:2px 8px;font-size:12px;margin-left:6px}
  </style>
</head>
<body>

<!-- LOGIN -->
<div id="login" class="container">
  <div class="card" style="max-width:420px;margin:auto;margin-top:8vh">
    <h2>Cadastro / Entrada</h2>
    <p style="font-size:13px;color:#cbd0ff">
      Por favor, n√£o compartilhe seu e-mail com desconhecidos.
      Pessoas que conhe√ßam este site podem tentar se passar por voc√™.
    </p>
    <input id="email" placeholder="E-mail" />
    <input id="password" type="password" placeholder="Senha" />
    <button onclick="login()">Entrar</button>
  </div>
</div>

<!-- SITE -->
<div id="site" class="hidden">
  <header>
    <h3>BLOX FRUITS UP</h3>
    <button class="secondary" onclick="toggleNotif()">
      üîî <span id="badge" class="badge hidden">0</span>
    </button>
  </header>

  <div class="container">
    <h2 id="welcome"></h2>
    <div class="grid">
      <div class="card"><h4>Max Level</h4><button onclick="order('Max Level')">Pedir</button></div>
      <div class="card"><h4>Ra√ßa V1</h4><button onclick="order('Ra√ßa V1')">Pedir</button></div>
      <div class="card"><h4>Ra√ßa V2</h4><button onclick="order('Ra√ßa V2')">Pedir</button></div>
      <div class="card"><h4>Ra√ßa V3</h4><button onclick="order('Ra√ßa V3')">Pedir</button></div>
    </div>
  </div>
</div>

<!-- NOTIFICA√á√ïES -->
<div id="notif" class="notif hidden"></div>
<div id="toast" class="toast hidden"></div>

<script>
  // üî• CONFIG FIREBASE (SUBSTITUA PELOS SEUS DADOS)
  const firebaseConfig = {
    apiKey: "SUA_API_KEY",
    authDomain: "SEU_DOMINIO.firebaseapp.com",
    projectId: "SEU_PROJECT_ID",
  };

  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();

  // üëë DONO
  const OWNER_EMAIL = "davi.243100@gmail.com";
  const OWNER_PASSWORD = "king";
  let currentUser = null;

  // üîê LOGIN
  function login(){
    const email = emailInput();
    const password = passInput();
    if(!email || !password) return alert("Preencha tudo");

    auth.signInWithEmailAndPassword(email,password)
      .then(res=>initUser(res.user,password))
      .catch(()=>{
        auth.createUserWithEmailAndPassword(email,password)
          .then(res=>initUser(res.user,password));
      });
  }

  function initUser(user,password){
    const isOwner = user.email === OWNER_EMAIL && password === OWNER_PASSWORD;
    currentUser = { uid:user.uid, email:user.email, isOwner };

    document.getElementById("login").classList.add("hidden");
    document.getElementById("site").classList.remove("hidden");
    document.getElementById("welcome").innerText = isOwner ? "Painel do King" : "Bem-vindo";

    if(isOwner) listenOrders();
  }

  // üõí PEDIDOS
  function order(product){
    db.collection("orders").add({
      product,
      userEmail: currentUser.email,
      status: "novo",
      created: firebase.firestore.FieldValue.serverTimestamp()
    });
    toast("Estamos enviando seu pedido para o vendedor...");
  }

  // üîî NOTIFICA√á√ïES / HIST√ìRICO
  function listenOrders(){
    db.collection("orders").orderBy("created","desc")
      .onSnapshot(snapshot=>{
        const box = document.getElementById("notif");
        box.innerHTML = "<h4>Pedidos / Hist√≥rico</h4>";
        document.getElementById("badge").classList.remove("hidden");
        document.getElementById("badge").innerText = snapshot.docs.length;

        snapshot.forEach(doc=>{
          const o = doc.data();
          const div = document.createElement("div");
          div.className="card";
          div.innerHTML = `
            <b>${o.userEmail}</b><br>
            ${o.product}<br>
            Status: ${o.status}
          `;
          if(o.status==="novo"){
            const btn=document.createElement("button");
            btn.innerText="Aceitar pedido";
            btn.onclick=()=>db.collection("orders").doc(doc.id).update({status:"aceito"});
            div.appendChild(btn);
          }
          box.appendChild(div);
        });
      });
  }

  // UI
  function toggleNotif(){
    document.getElementById("notif").classList.toggle("hidden");
  }
  function toast(msg){
    const t=document.getElementById("toast");
    t.innerText=msg;
    t.classList.remove("hidden");
    setTimeout(()=>t.classList.add("hidden"),3000);
  }

  function emailInput(){return document.getElementById("email").value.trim();}
  function passInput(){return document.getElementById("password").value.trim();}
</script>

</body>
</html>
